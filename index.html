<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Somatization Study Questionnaire</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 820px; margin: 24px auto; padding: 0 14px; }
    h1 { font-size: 20px; margin-bottom: 8px; }
    .note { color:#333; font-size: 14px; line-height: 1.4; }
    .card { border:1px solid #ddd; border-radius: 12px; padding: 14px; margin: 14px 0; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { font-size: 14px; display:block; margin-bottom: 6px; }
    input, select { width: 100%; padding: 10px; border:1px solid #ccc; border-radius: 10px; }
    .q { margin: 12px 0; }
    .q p { margin: 0 0 8px; font-size: 14px; }
    .opts { display:flex; gap:10px; flex-wrap: wrap; }
    .opt { display:flex; align-items:center; gap:6px; }
    button { padding: 12px 14px; border:0; border-radius: 12px; cursor:pointer; }
    button.primary { background:#111; color:#fff; }
    .result { white-space: pre-wrap; background:#f7f7f7; border-radius: 12px; padding: 12px; }
  </style>
</head>
<body>

<h1>Somatization Research Questionnaire</h1>
<div class="note">
  Timeframe: Axis A (past 6 months), Axis B (past 4 weeks).<br>
  This is for research measurement and does not provide a diagnosis.
</div>

<form id="form" class="card">
  <h2 style="font-size:16px;margin:0 0 10px;">Demographics</h2>
  <div class="row">
    <div>
      <label>Participant ID (optional)</label>
      <input name="participant_id" placeholder="Leave blank to auto-generate" />
    </div>
    <div>
      <label>Age</label>
      <input name="age" type="number" min="12" max="100" required />
    </div>
  </div>
  <div class="row" style="margin-top:12px;">
    <div>
      <label>Sex</label>
      <select name="sex" required>
        <option value="">Select</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other / Prefer not to say</option>
      </select>
    </div>
    <div></div>
  </div>

  <h2 style="font-size:16px;margin:18px 0 8px;">Axis A — Somatization-prone traits (0–4)</h2>
  <div class="note">0 = Not at all, 1 = Slightly, 2 = Moderately, 3 = Strongly, 4 = Extremely</div>

  <div id="axisA"></div>

  <h2 style="font-size:16px;margin:18px 0 8px;">Axis B — Somatic symptoms (0–2)</h2>
  <div class="note">0 = Not bothered, 1 = Somewhat, 2 = A lot (past 4 weeks)</div>

  <div id="axisB"></div>

  <div style="margin-top:16px; display:flex; gap:10px; align-items:center;">
    <button class="primary" type="submit">Submit</button>
    <span id="status" class="note"></span>
  </div>
</form>

<div class="card">
  <h2 style="font-size:16px;margin:0 0 10px;">Your result</h2>
  <div id="out" class="result">Submit the form to see your scores.</div>
</div>

<script>
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzhx9vIvsv4ugxG8bPV8AFnXEWKcxQi-O3ILF3EY13_ubOMR4BqF8mOrahXLqSCEeDp/exec";

  const axisAItems = [
    "I often feel physical discomfort without being able to identify what emotion I’m feeling.",
    "Stress or conflict quickly turns into physical tension or discomfort in my body.",
    "I closely monitor bodily sensations that others would ignore.",
    "Once I notice a bodily sensation, it is hard to shift attention away from it.",
    "During stress, I feel disconnected from my body or emotions.",
    "My body reacts strongly even when I feel emotionally numb.",
    "Symptoms worsen when I feel pressured, trapped, or overwhelmed.",
    "Normal sensations often feel intense or alarming to me.",
    "Being alone tends to make my physical symptoms worse.",
    "I feel my body is expressing something my mind cannot put into words."
  ];

  const axisBItems = [
    "Headaches or head pressure",
    "Chest tightness or palpitations",
    "Shortness of breath",
    "Stomach pain, nausea, or indigestion",
    "Bowel disturbance (diarrhea/constipation)",
    "Muscle tension or body aches",
    "Jaw/face pain or clenching-related discomfort",
    "Dizziness or lightheadedness",
    "Fatigue or low energy",
    "Sleep disturbance",
    "Tingling/numbness sensations",
    "Unexplained pain in multiple body areas"
  ];

  function renderMC(containerId, items, namePrefix, options) {
    const wrap = document.getElementById(containerId);
    wrap.innerHTML = "";
    items.forEach((txt, idx) => {
      const qNum = idx + 1;
      const name = namePrefix + qNum;
      const div = document.createElement("div");
      div.className = "q";
      div.innerHTML = `
        <p><b>${namePrefix}${qNum}.</b> ${txt}</p>
        <div class="opts">
          ${options.map(v => `
            <label class="opt">
              <input type="radio" name="${name}" value="${v}" required />
              ${v}
            </label>
          `).join("")}
        </div>
      `;
      wrap.appendChild(div);
    });
  }

  renderMC("axisA", axisAItems, "A", [0,1,2,3,4]);
  renderMC("axisB", axisBItems, "B", [0,1,2]);

  document.getElementById("form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const status = document.getElementById("status");
    const out = document.getElementById("out");
    status.textContent = "Submitting…";

    const fd = new FormData(e.target);
    const payload = {};
    for (const [k,v] of fd.entries()) payload[k] = v;

    try {
      const res = await fetch(WEB_APP_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const json = await res.json();
      if (!json.ok) throw new Error(json.error || "Unknown error");

      out.textContent =
        `Participant ID: ${json.participant_id}\n` +
        `Axis A total (0–40): ${json.A_total}\n` +
        `Axis B total (0–24): ${json.B_total}\n\n` +
        `Live sample size: ${json.n_samples}\n` +
        `Live correlation r(A_total, B_total): ${json.correlation_r === null ? "N/A" : json.correlation_r.toFixed(3)}\n` +
        `${json.interpretation}`;

      status.textContent = "Submitted ✔";
      e.target.reset();
    } catch (err) {
      status.textContent = "";
      out.textContent = "Submission failed: " + err.message;
    }
  });
</script>

</body>
</html>